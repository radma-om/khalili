/* empty css                */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(e){if(e.ep)return;e.ep=!0;const a=n(e);fetch(e.href,a)}})();const p=window.Cookies;let l={};document.addEventListener("DOMContentLoaded",async()=>{if(!p.get("username")){window.location.href="login.html";return}await h()});async function h(){try{const s=["./Data/Classes/الصف الأول.xlsx","./Data/Classes/الصف الثاني.xlsx","./Data/Classes/الصف الثالث.xlsx"];for(const t of s)try{const n=await fetch(t);if(n.ok){const o=await n.json(),e=t.split("/").pop().replace(".xlsx","");l[e]=o}}catch(n){console.error(`Error loading class file ${t}:`,n)}g(Object.keys(l))}catch(s){console.error("Error loading class files:",s)}}function g(s){const t=document.getElementById("classSelect");t.innerHTML='<option value="">اختر الصف</option>',s.forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=n,t.appendChild(o)})}var u;(u=document.getElementById("classSelect"))==null||u.addEventListener("change",s=>{const t=s.target.value;t&&y(l[t])});function y(s){const t=document.getElementById("studentList");t.innerHTML="",s.forEach(n=>{const o=document.createElement("div");o.className="flex items-center p-2 hover:bg-blue-50 rounded-lg transition-colors duration-200";const e=document.createElement("input");e.type="checkbox",e.className="student-checkbox ml-3",e.value=n.id;const a=document.createElement("label");a.className="flex-1 cursor-pointer",a.textContent=`${n.name} - ${n.phone}`,o.appendChild(e),o.appendChild(a),t.appendChild(o)})}var m;(m=document.getElementById("selectAll"))==null||m.addEventListener("change",s=>{document.querySelectorAll(".student-checkbox").forEach(n=>{n.checked=s.target.checked})});window.updateEventVariable=function(){document.getElementById("eventInput").value};window.insertVariable=function(s){const t=document.getElementById("messageTemplate"),n=t.value,o=t.selectionStart,e={studentName:"{{studentName}}",teacherName:"{{teacherName}}",className:"{{className}}",date:"{{date}}",event:"{{event}}",time:"{{time}}"},a=n.slice(0,o)+e[s]+n.slice(o);t.value=a,t.focus()};window.sendMessages=async function(){const s=document.getElementById("messageTemplate").value,t=document.getElementById("classSelect").value,n=document.getElementById("eventInput").value;if(!n){alert("الرجاء إدخال الحدث قبل إرسال الرسائل");return}const o=document.querySelectorAll(".student-checkbox:checked"),e=Array.from(o).map(i=>i.value);let a=0,c=0;for(const i of e){const r=l[t].find(d=>d.id===i);if(r){const d=w(s,{studentName:r.name,teacherName:p.get("teacherName"),className:t,date:new Date().toLocaleDateString("ar-SA"),time:new Date().toLocaleTimeString("ar-SA"),event:n});try{await v(r.phone,d),a++}catch(f){console.error(`Error sending message to ${r.name}:`,f),c++}}}alert(`تم إرسال ${a} رسالة بنجاح
فشل إرسال ${c} رسالة`)};function w(s,t){let n=s;for(const[o,e]of Object.entries(t))n=n.replace(new RegExp(`{{${o}}}`,"g"),e);return n}async function v(s,t){const n="AC30f8388777afe643e27075357a0d0e0d",o="92f161ab047545492af766e3fee1a19d";try{const e=await fetch(`https://api.twilio.com/2010-04-01/Accounts/${n}/Messages.json`,{method:"POST",headers:{Authorization:"Basic "+btoa(`${n}:${o}`),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({To:`whatsapp:+${s}`,From:"whatsapp:+14155238886",Body:t})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("Error sending WhatsApp message:",e),e}}
